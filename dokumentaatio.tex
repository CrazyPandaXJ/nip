% NIP - project documentation
% Mikko Korpela, Antti Rasinen, Janne Toivola 2004
% $Id: dokumentaatio.tex,v 1.4 2004-08-20 14:32:40 jatoivol Exp $

\documentclass[12pt,a4paper]{report}
%\bibliographystyle{unsrt}
\setlength{\topmargin}{0mm}
\setlength{\oddsidemargin}{0mm}
\setlength{\textheight}{22cm}
\setlength{\textwidth}{16cm}
\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage[english]{babel}
\usepackage[dvips]{graphicx}
\usepackage{amsmath}
\usepackage{subfigure}
\usepackage{tocbibind}
\usepackage{fancyvrb}
%\newcommand{\argmax}{\mathrm{argmax}}
%\newcommand{\argmin}{\mathrm{argmin}}
%\newcommand{\define}{\stackrel{\mathrm{def}}{=}}

%--------------------
% Place this in the preamble of your LaTeX file:
% (c) Jaakko Hollmen, 2002

\usepackage{ifthen}

% Declare the variable doublespaced
\newboolean{doublespaced}

% Comment one of the following lines to either select
% doublespaced or singlespaced:
\setboolean{doublespaced}{false}
%\setboolean{doublespaced}{true}

\ifthenelse{\boolean{doublespaced}}
{
  % Double spaced text if variable "doublespaced" is true:
  \renewcommand{\baselinestretch}{1.5}
  \normalsize % necessary to execute the previous thing
}
{
  % This is to be executed if doublespace is false:
  % else = do nothing
}
%--------------------

\title{NIP}
\author{Antti Rasinen}
\author{Mikko Korpela 54919L}
\author{Janne Toivola 55173U}
\begin{document}

\pagestyle{empty}
\setlength{\parindent}{0mm}
\setlength{\parskip}{3mm}

\large
\textbf{The NIP project}\\

\vspace{45mm}

\begin{centering}
\huge
\textbf{System description}\\ % Any better names for this?
\end{centering}

\parbox{5cm}{\ }
\parbox{1em}{\vskip8cm}

\normalsize
\vspace{5mm}
\begin{tabbing}
The Team:\= Antti Rasinen\\
         \> Mikko Korpela\\
         \> Janne Toivola\\
\vspace{5mm}

\end{tabbing}
%----------------------
Date: \today
%----------------------
\eject\newpage

\pagestyle{plain}

\tableofcontents

%\newpage
%
%\listoffigures


% Reminder about the style so far: 
% - C data types     {\it unsigned long}
% - code examples    \verb+this = is_an(example);+
% - file names       \verb+filename.txt+
% - defined stuff    \textbf{A_DEFINED_VALUE}
% - parameter names  \textbf{parameter}
% ...
% Try to keep it consistent...


\newpage
\chapter{General description}

Some introduction here...

\section{Overview}

Some outline of the system...

\newpage
\chapter{Subsystem descriptions}
\section{Variables}
\subsection{General}

The idea and mathematical formulas...

\subsection{The functionality description}

\subsubsection{The data structure}
The data type ''Variable'' defined in \verb+Variable.h+ is a pointer 
to a struct which has the following fields: 
\begin{description}
\item[symbol] is a short string used to identify the variable. Maximum
length is defined as \textbf{VAR\_SYMBOL\_LENGTH} in
\verb+Variable.h+. To ensure the correct operation of the system, the 
symbol should be unique.

\item[name] is a little longer name to describe the variable: it is
called {\it label} in the Hugin net files. This is NOT used for 
identification of the variables and it doesn't need to be unique. 
The maximum length is defined as \textbf{VAR\_NAME\_LENGTH} in 
\verb+Variable.h+.

\item[statenames] is an array of strings containing names for all
possible states of the variable. The identification of data relies on
these strings. The size of the statenames array i.e. number of
strings should be the same as the number of states indicated by
cardinality field described below.

\item[cardinality] is a positive integer which tells how many states
the variable can have. It plays an important role in all calculations
so it better be correct: the value is not meant to be altered.

\item[id] is an {\it unsigned long} used for identification inside the
system. It is set automatically by the \verb+new_variable+ function
and should not be tampered after that.

\item[likelihood] is a {\it double} array describing the probability
distribution of the states of the variable. It is used only for
entering evidence into the system and likelihood arrays of the latent
variables remain filled with ones. Size of the array equals
cardinality, of course.

\item[previous] is used to describe the repetitive structure in
timeslice models. It is a pointer to the variable which this variable
will replace in previous timeslice. The pointer is {\it NULL} if the
model has no repetitive structure.

\item[next] is a same kind of pointer as \textbf{previous} above, but
this one tells which variable will be replaced in the next timeslice.
The \textbf{previous} and \textbf{next} pointers should be symmetrical
i.e. if \verb+a->next == b+ then \verb+b->previous == a+.
\end{description}

\verb+Variable.h+ provides also data types for implementing lists of
variables. Both \verb+varlink+ and \verb+Variable_iterator+ are
pointers to structs which contain following fields:
\begin{description}
\item[data] is the variable (i.e. pointer to a variable struct) 
contained by the list element.

\item[fwd] is a pointer to the next element in the list or {\it NULL}
at the end of the list.

\item[bwd] is a pointer to the previous element in the list or 
{\it NULL} at the beginning of the list.
\end{description}
Variable iterators are meant to be used the same way as list iterators
in Java: you can get the next element contained by the list by just 
calling \verb+next_Variable(iterator)+. On the other hand, iterators
are NOT meant to be the only reference to a list because it will
advance in the list, pointing always to the next element and eventually
be a null pointer.


\subsubsection{The functions}
The functions provided in \verb+Variable.c+ are
%The interface + how the stuff works...
\begin{description}
\item[new\_variable(symbol, name, states, cardinality)] creates a
variable identified with the \textbf{symbol} string. The \textbf{name} 
string will be copied as the name field of the new variable. Both the 
\textbf{symbol} and \textbf{name} strings may be truncated to the 
allowed length. The states of the new variable will be named according 
to the given string array \textbf{states}. All the given strings are 
copied, so remember to free them after they become useless.

\item[copy\_variable(v)] returns an exact copy of the
variable~\textbf{v}. Note that also the id~field is copied and 
consequently there may not be two copies of the same variable in the 
same model.

\item[free\_variable(v)] frees the memory allocated for the
variable~\textbf{v}. 

\item[equal\_variables(v1, v2)] returns 0 if either of the variables
are null. Otherwise it will tell if the variables have equal id fields
or not.

\item[get\_id(v)] will return the unsigned long id field of the 
variable~\textbf{v}.

\item[get\_symbol(v)] returns the symbol of the variable~\textbf{v}. It
will not make a copy of the string so don't mess with it.

\item[get\_stateindex(v, state)] tells the place of the string
\textbf{state} in the state name array of the
variable~\textbf{v}. This index can be used to interpret various
arrays describing probability distributions. 

\item[total\_num\_of\_vars()] is used only to aid the Hugin net file
parser to return the total number of newly created variables. All 
the variables created with \textbf{new\_variable} are accumulated 
in a list and this function can tell the size of that list.

\item[get\_first\_variable()] gives the first element in the list
of newly created variables mentioned above.

\item[get\_last\_variable()] gives the last element in the list
of newly created variables mentioned above.

\item[reset\_Variable\_list()] will replace the list of recently created
variables with {\it NULL} and set the size of the list to zero. This
is used only for resetting the list after copying the list pointer
to a new model. Otherwise all the models would share the same list of
parsed variables.

\item[next\_Variable(it)] will give the next variable pointed by the
variable iterator~\textbf{it} and advance the pointer to the next
variable in the list. The function returns {\it NULL} if the iterator
runs out of variables.

\item[get\_parser\_variable(symbol)] aids the net file parser to find a
variable, identified by the \textbf{symbol} string, in the list of newly
created variables.

\item[get\_variable(it, symbol)] searches the
variable iterator~\textbf{it} for a variable identified by the string
\textbf{symbol}. The iterator will be used by the function, so it will
not be pointing to the beginning of any lists anymore.

\item[update\_likelihood(v, likelihood)] will set the likelihood array
of variable~\textbf{v} according to the given double array 
\textbf{likelihood}. Size of the given array should be the same 
(or more) than the cardinality of the variable.

\item[reset\_likelihood(v)] fills the likelihood array of the
variable~\textbf{v} with ones. This means that the likelihood of the
variable states will be uniform.

\item[number\_of\_values(v)] returns the cardinality of the
variable~\textbf{v}. It is the exact number of states the variable has
and will always have.
\end{description}


\subsection{Other possibilities}

How the stuff could also work...


\newpage
\section{Graphs}
\subsection{General}

The idea and mathematical formulas...


\subsection{The functionality description}
%The interface + how the stuff works...
\subsubsection{The data structures}

\subsubsection{The functions}


\subsection{Other possibilities}

How the stuff could also work...


\newpage
\section{Potentials}
\subsection{General}

The idea and mathematical formulas...

\subsection{The functionality description}
%The interface + how the stuff works...
\subsubsection{The data structure}

\subsubsection{The functions}


\subsection{Other possibilities}

How the stuff could also work...


\newpage
\section{Join trees} % Cliques and sepsets
\subsection{General}

The idea and mathematical formulas...

\subsection{The functionality description}
%The interface + how the stuff works...
\subsubsection{The data structures}

\subsubsection{The functions}


\subsection{Other possibilities}

How the stuff could also work...


\newpage
\section{The Hugin net file parser}
\subsection{General}

The idea and mathematical formulas...

\subsection{The functionality description}

The interface + how the stuff works...

\subsection{Other possibilities}

How the stuff could also work...


\newpage
\section{The timeslice handler} % Some system which handles time series?
\subsection{General}

The idea and mathematical formulas...

\subsection{The functionality description}

The interface + how the stuff works...

\subsection{Other possibilities}

How the stuff could also work...



\newpage
\chapter{System analysis}
\section{The parser}

\section{The graph}

\section{The join tree}

\section{The timeslice-monster}


\newpage
\chapter{Comments}


\newpage
%\appendix
%\newpage
%\bibliography{dokumentaatio}

\end{document}
